---
title: "Sam's blood counts"
subtitle: "Round 2 of chemotherapy"
search: false
date: today
format:
  html: default
  
knitr: 
  opts_chunk: 
    eval: false
    message: false
    warning: false
    echo: false
code-fold: true
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
```

Data has been provided daily by the medical team here at BC Children's Hospital. Day 1, May 12, 2023, was the start of Sam's second round of chemotherapy.

```{r}
## Import the data 

dat <- 
  readxl::read_xlsx(path = "~/workspace/family/sams_journey/sams_journey/data/events-and-gifts.xlsx",
                    sheet = "Blood"
  )

dat$Current[dat$Round == 2] <- T
dat$Current[dat$Round != 2] <- F

dat$label[dat$Current == F] <- "previous"
dat$label[dat$Current == T] <- "current"



dat <- dat %>% 
  dplyr::select(-Comment) %>% 
  # dplyr::select(Date: Current) %>%  
  pivot_longer(WBC:ANC, 
               names_to = "Metric", 
               values_to = "Values") %>% 
  mutate(Date = date(Date))

# start <- min(dat$Date) -1

dat <- dat %>% 
  mutate(#Day =  Date - start,
         Metric = factor(Metric, 
                         levels = c("WBC", "Hgb", "PHS", "ANC")))

dat$lw <- dat$Current *0.5 + 0.5



```

```{r}
#| fig-height: 8
#| eval: false

## graph the data 
g <- dat %>% ggplot(aes(x = Day, y = Values, color = label, linewidth = label, size = label)) +
  # geom_smooth(method = "loess",se = F, alpha = .5, size = .2) +
  geom_line() + 
  geom_line(aes(alpha = 0.5), show.legend = F) +
  geom_point() +
  facet_grid(rows = "Metric",
             scales = "free_y")  +
  coord_cartesian(ylim = c(0, NA),
                  xlim = c(1, NA)) +
  labs(title = "Blood counts",
       subtitle = "Current and previous rounds of chemo-therapy",
       x = "Day",
       y = NULL,
       color = NULL,
       linewidth = NULL, 
       size = NULL) +
  # scale_color_manual(values = c("TRUE" = "red", "FALSE" = "grey")) +
  scale_color_manual(values = c("current" = "red", "previous" = "grey")) + 
  scale_linewidth_manual(values = c("current" = 1, "previous" = 0.4)) +
  scale_size_manual(values = c("current" = 1.5, "previous" = .7)) +
  theme(legend.position = "bottom")

g

ggsave(height = 8, width = 6, 
       path = "/home/rstudio/workspace/family/sams_journey/sams_journey/_img/",
       filename = "blood_graph.png",plot = g,
       dpi = 200)

  
```

![Blood counts from chemo round 2](https://samsstory.s3.ca-central-1.amazonaws.com/blood_graph.png)
